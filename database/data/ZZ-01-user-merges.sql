-- ========================================
-- USER MERGES AND DEDUPLICATION
-- ========================================
-- This file merges duplicate users from different data sources
-- Run after all user data is loaded (APSL, CASA, GroupMe)
--
-- USAGE:
-- 1. Run: node database/scripts/find-duplicates.js
-- 2. Review output in database/reports/duplicates-[date].txt
-- 3. Add merge SQL below for confirmed duplicates
-- 4. Rebuild: ./dev.sh --apsl --casa --groupme
--
-- MERGE PATTERN:
-- For each duplicate:
--   1. Move external identities to correct user
--   2. Move team_players records to correct user
--   3. Move practice_attendances to correct user
--   4. Delete duplicate user
-- ========================================

-- Example merge (commented out):
-- -- Merge: Bility￿ffe2￿ff9a￿ffbd (GroupMe) → Mohamed Bility (APSL)
-- WITH 
--   correct_user AS (SELECT id FROM users WHERE first_name = 'Mohamed' AND last_name = 'Bility'),
--   duplicate_user AS (SELECT id FROM users WHERE last_name LIKE 'Bility%' AND first_name LIKE '%ffe2%')
-- UPDATE user_external_identities 
-- SET user_id = (SELECT id FROM correct_user)
-- WHERE user_id = (SELECT id FROM duplicate_user) AND provider = 'groupme';
--
-- UPDATE team_players 
-- SET player_id = (SELECT id FROM correct_user)
-- WHERE player_id = (SELECT id FROM duplicate_user);
--
-- UPDATE practice_attendances
-- SET user_id = (SELECT id FROM correct_user)
-- WHERE user_id = (SELECT id FROM duplicate_user);
--
-- DELETE FROM players WHERE id = (SELECT id FROM duplicate_user);
-- DELETE FROM users WHERE id = (SELECT id FROM duplicate_user);

-- Add your merges below:

